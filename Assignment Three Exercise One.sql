drop table if exists Customers, Orders, OrderDetails, Products, Categories, Employees, Shippers cascade;
create table Customers (
	customer_id int primary key,
	first_name text not null,
	last_name text not null,
	email text not null
);

create table Orders (
	order_id int primary key,
	customer_id int not null,
	order_date date null,
	delivery_address text not null,
	foreign key(customer_id) references Customers(customer_id)
);

create table Categories (
	category_id int primary key,
	category_name text not null,
	category_description text not null,
	category_image text not null
);

create table Products (
	product_id int  primary key,
	product_name text not null, 
	product_price int not null,
	category_id int not null,
	foreign key(category_id) references Categories(category_id)
);

create table Shippers (
	shipper_id int primary key,
	shipper_name text not null,
	shipper_contact_info text not null,
	shipper_address text not null
);

create table Employees (
	employee_id int primary key,
	employee_first_name text not null,
	employee_last_name text not null,
	employee_job_title text not null
);

create table OrderDetails (
	order_id int not null,
	product_id int not null,
	order_reply text not null, -- comment to the order left by the consumer
	shipper_id int not null,
	employee_id int not null,
	foreign key(order_id) references Orders(order_id),
	foreign key(product_id) references Products(product_id),
	foreign key(shipper_id) references Shippers(shipper_id),
	foreign key(employee_id) references Employees(employee_id)
);

insert into Customers (customer_id, first_name, last_name, email) values 
    (1, 'John', 'Smith', 'john.smith@email.com'),
    (2, 'Mary', 'Johnson', 'mary.johnson@email.com'),
    (3, 'David', 'Brown', 'david.brown@email.com'),
    (4, 'Sarah', 'Wilson', 'sarah.wilson@email.com'),
    (5, 'Michael', 'Davis', 'michael.davis@email.com'),
	(6, 'Nurbol', 'Alimkulov', '220103036@stu.sdu.edu.kz');
select * from Customers;

insert into Categories (category_id, category_name, category_description, category_image) values
    (101, 'Electronics', 'Category for electronic devices', 'electronics.jpg'),
    (102, 'Clothing', 'Category for clothing items', 'clothing.jpg'),
    (103, 'Home and Garden', 'Category for home and garden products', 'home_garden.jpg'),
    (104, 'Toys and Games', 'Category for toys and games', 'toys_games.jpg'),
    (105, 'Sports and Outdoors', 'Category for sports equipment', 'sports_outdoors.jpg'),
    (106, 'Books', 'Category for books and literature', 'books.jpg');
select * from Categories;

insert into Products (product_id, product_name, product_price, category_id) values
    (1, 'Product A', 20, 101),
    (2, 'Product B', 30, 102),
    (3, 'Product C', 25, 103),
    (4, 'Product D', 40, 104),
    (5, 'Product E', 15, 106),
	(6, 'Product F', 55, 106);
select * from Products;

insert into Employees (employee_id, employee_first_name, employee_last_name, employee_job_title) values
    (1, 'John', 'Smith', 'Manager'),
    (2, 'Mary', 'Johnson', 'Sales Associate'),
    (3, 'David', 'Brown', 'Customer Service Representative'),
    (4, 'Sarah', 'Wilson', 'Accountant'),
    (5, 'Michael', 'Davis', 'IT Specialist'),
    (6, 'Jennifer', 'Lee', 'Marketing Coordinator');
select  * from Employees;

insert into Shippers (shipper_id, shipper_name, shipper_contact_info, shipper_address) values
    (201, 'Shipper1', 'Contact Info 1', 'Address 1'),
    (202, 'Shipper2', 'Contact Info 2', 'Address 2'),
    (203, 'Shipper3', 'Contact Info 3', 'Address 3'),
    (204, 'Shipper4', 'Contact Info 4', 'Address 4'),
    (205, 'Shipper5', 'Contact Info 5', 'Address 5'),
    (206, 'Shipper6', 'Contact Info 6', 'Address 6');
select * from Shippers;

insert into Orders (order_id, customer_id, order_date, delivery_address) values
    (1, 1, '2023-10-14', '123 Main Street, City A, Country X'),
    (2, 2, '2023-10-15', '456 Elm Street, City B, Country Y'),
    (3, 3, '2023-10-15', '789 Oak Street, City C, Country Z'),
    (4, 4, '2023-10-16', '101 Pine Street, City D, Country W'),
    (5, 5, '2023-10-16', '202 Maple Street, City E, Country V'),
	(6, 6, '2023-10-16', '203 Maple Street, City E, Country V');
select * from Orders;

insert into OrderDetails (order_id, product_id, order_reply, shipper_id, employee_id) values
    (1, 1, 'Product received in good condition.', 201, 1),
    (2, 2, 'Fast delivery, very satisfied.', 202, 2),
    (3, 3, 'Missing one item in the order.', 203, 3),
    (4, 4, 'Product damaged during delivery.', 204, 4),
    (5, 5, 'Excellent service, no issues.', 205, 5),
	(6, 6, 'Fast delivery', 203, 6);
select * from OrderDetails;

-- Retrieve the total revenue generated by each product category.
select Categories.category_name, sum(Products.product_price) as total_sales
from Categories
join Products on Categories.category_id = Products.category_id
join OrderDetails on Products.product_id = OrderDetails.product_id
group by Categories.category_name
order by total_sales DESC;

-- Find the top 5 customers with the highest total purchase amount.
select Customers.first_name, Customers.last_name, sum(Products.product_price) as total_purchase
from Customers
join Orders on Customers.customer_id = Orders.customer_id
join OrderDetails on Orders.order_id = OrderDetails.order_id
join Products on OrderDetails.product_id = Products.product_id
group by Customers.customer_id
order by total_purchase desc
limit 5;

-- Calculate the total sales revenue for each employee.
select Employees.employee_first_name, Employees.employee_last_name, sum(Products.product_price) as total_sales
from Employees
join OrderDetails on Employees.employee_id = OrderDetails.employee_id
join Products on OrderDetails.product_id = Products.product_id
group by Employees.employee_id
order by total_sales desc;

-- Identify the most popular product (based on the total quantity sold).
select Products.product_name, Products.product_price, count(OrderDetails.product_id) as population_in_count
from Products
join OrderDetails on Products.product_id = OrderDetails.product_id
group by Products.product_id
order by population_in_count desc;
